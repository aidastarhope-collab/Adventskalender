<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adventskalender</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #26000b 0%, #4a0820 25%, #2d0a1f 50%, #1a0510 75%, #26000b 100%);
      background-attachment: fixed;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    
    /* Snowflakes */
    .snowflake {
      position: fixed;
      top: -10px;
      color: white;
      font-size: 1em;
      user-select: none;
      z-index: 1;
      pointer-events: none;
      animation: fall linear infinite;
    }
    
    @keyframes fall {
      to {
        transform: translateY(100vh);
      }
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
    }
    
    /* Logo Header */
    .logo-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .logo-header img {
      max-width: 500px;
      width: 100%;
      height: auto;
      filter: drop-shadow(2px 2px 8px rgba(0,0,0,0.5));
    }
    
    /* Fallback wenn kein Bild geladen wird */
    h1 {
      text-align: center;
      color: white;
      font-size: 3em;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      font-family: 'Playfair Display', serif;
      font-weight: 700;
    }
    
    .hidden { display: none; }
    
    /* Login Styles */
    #login {
      background: white;
      max-width: 400px;
      margin: 50px auto;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    
    #login h2 {
      color: #26000b;
      margin-bottom: 20px;
      text-align: center;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
    }
    
    #login input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }
    
    #login input:focus {
      outline: none;
      border-color: #26000b;
    }
    
    #login button {
      width: 100%;
      padding: 12px;
      background: #26000b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
      transition: background 0.3s;
    }
    
    #login button:hover {
      background: #3d0011;
    }
    
    #login-msg {
      color: #26000b;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }
    
    /* Calendar Styles */
    #calendar {
      color: white;
    }
    
    .welcome-section {
      text-align: center;
      margin-bottom: 30px;
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 15px;
    }
    
    .welcome-section h2 {
      font-size: 2em;
      margin-bottom: 10px;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
    }
    
    #progress {
      font-size: 1.3em;
      font-weight: bold;
      color: #ffffff;
    }
    
    .logout-btn {
      padding: 10px 30px;
      background: white;
      color: #26000b;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin-top: 15px;
      transition: all 0.3s;
    }
    
    .logout-btn:hover {
      background: #f0f0f0;
      transform: scale(1.05);
    }
    
    /* Door Grid */
    #doors {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 200px;
      margin-top: 30px;
    }
    
    /* Double Door Container */
    .door-container {
      position: relative;
      height: 280px;
      perspective: 1000px;
    }
    
    /* Locked Door Styling */
    .door-container.locked .door-left,
    .door-container.locked .door-right {
      cursor: not-allowed;
      filter: brightness(0.6);
    }
    
    .door-container.locked .door-left:hover,
    .door-container.locked .door-right:hover {
      filter: brightness(0.6);
    }
    
    .door-content {
      position: absolute;
      width: 100%;
      height: 100%;
      background: #5e001b;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      border: 3px solid #692230;
    }
    
    .door-content h3 {
      color: white;
      margin-bottom: 15px;
      font-size: 1.3em;
      text-align: center;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
    }
    
    .door-content .story-btn {
      background: linear-gradient(135deg, #5e001b 0%, #5f1027 100%);
      color: white;
      border: 2px solid #26000b;
      margin-bottom: 15px;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .door-content .story-btn:hover {
      background: linear-gradient(135deg, #5e001b 0%, #5f1027 100%);
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }
    
    .door-content input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 2px solid white;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .door-content button {
      width: 100%;
      padding: 10px;
      background: white;
      color: #4c0513;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      margin-bottom: 8px;
    }
    
    .door-content button:hover {
      background: #ffe4e1;
      transform: scale(1.05);
    }
    
    .door-content .close-btn {
      background: transparent;
      border: 2px solid white;
      color: white;
    }
    
    .door-content .status {
      text-align: center;
      margin-top: 5px;
      font-size: 1.3em;
    }
    
    /* Double Doors */
    .door-left, .door-right {
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      background: #5e001b;
      border: 3px solid #692230;
      transition: transform 1s ease-in-out;
      transform-style: preserve-3d;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    
    .door-left {
      left: 0;
      border-radius: 12px 0 0 12px;
      transform-origin: left;
    }
    
    .door-right {
      right: 0;
      border-radius: 0 12px 12px 0;
      transform-origin: right;
    }
    
    .door-container.open .door-left {
      transform: rotateY(-120deg);
    }
    
    .door-container.open .door-right {
      transform: rotateY(120deg);
    }
    
    .door-number {
      color: white;
      font-size: 3em;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .door-container.open .door-number {
      opacity: 0;
    }
    
    .door-container.open .crystal-icon {
      opacity: 0;
    }
    
    .door-left .door-number {
      margin-left: 20px;
    }
    
    .door-right .door-number {
      margin-right: 20px;
    }
    
    /* Crystal Image on right door */
    .crystal-icon {
      width: 60px;
      height: 60px;
      object-fit: contain;
      filter: drop-shadow(0 2px 8px rgba(255,255,255,0.3));
      transition: opacity 0.3s;
    }
    
    .door-left:hover, .door-right:hover {
      filter: brightness(1.1);
    }
    
    /* Lock Icon */
    .lock-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      pointer-events: none;
      transition: all 0.6s ease-out;
    }
    
    .door-container.unlocking .lock-container {
      animation: lockFall 0.8s ease-in forwards;
    }
    
    @keyframes lockFall {
      0% {
        transform: translate(-50%, -50%) rotate(0deg);
        opacity: 1;
      }
      70% {
        transform: translate(-50%, 100px) rotate(180deg);
        opacity: 0.5;
      }
      100% {
        transform: translate(-50%, 150px) rotate(360deg);
        opacity: 0;
      }
    }
    
    .door-container:not(.locked) .lock-container {
      display: none;
    }
    
    .lock-icon {
      width: 60px;
      height: 70px;
      position: relative;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
    }
    
    /* Lock body */
    .lock-body {
      width: 60px;
      height: 45px;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border-radius: 8px;
      position: absolute;
      bottom: 0;
      box-shadow: inset -2px -2px 5px rgba(0,0,0,0.2);
    }
    
    /* Lock shackle */
    .lock-shackle {
      width: 30px;
      height: 35px;
      border: 8px solid #FFD700;
      border-bottom: none;
      border-radius: 20px 20px 0 0;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }
    
    /* Keyhole */
    .lock-keyhole {
      width: 8px;
      height: 8px;
      background: #8B4513;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    .lock-keyhole::after {
      content: '';
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 8px solid #8B4513;
    }
    
    /* Story Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    .modal-content {
      background: linear-gradient(135deg, #5e001b 0%, #4a0820 100%);
      border: 3px solid #26000b;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
      animation: slideIn 0.4s ease-out;
      position: relative;
    }
    
    @keyframes slideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .modal-content h2 {
      color: #FFD700;
      font-family: 'Playfair Display', serif;
      font-size: 2em;
      margin-bottom: 20px;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    
    .modal-content p {
      color: white;
      font-size: 1.1em;
      line-height: 1.8;
      margin-bottom: 15px;
      text-align: justify;
    }
    
    .modal-close-btn {
      width: 100%;
      padding: 12px;
      background: #FFD700;
      color: #26000b;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin-top: 20px;
      transition: all 0.3s;
    }
    
    .modal-close-btn:hover {
      background: #FFA500;
      transform: scale(1.05);
    }
    
    /* Responsive */
    @media (max-width: 1000px) {
      #doors {
        grid-template-columns: repeat(3, 1fr);
        gap: 90px;
      }
      
      .logo-header img {
        max-width: 400px;
      }
    }
    
    @media (max-width: 700px) {
      #doors {
        grid-template-columns: repeat(2, 1fr);
        gap: 70px;
      }
      
      .door-container {
        height: 250px;
      }
      
      h1 {
        font-size: 2em;
      }
      
      .logo-header img {
        max-width: 300px;
      }
      
      .lock-icon {
        width: 50px;
        height: 60px;
      }
      
      .lock-body {
        width: 50px;
        height: 38px;
      }
      
      .lock-shackle {
        width: 25px;
        height: 30px;
        border-width: 6px;
      }
    }
    
    @media (max-width: 500px) {
      #doors {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .logo-header img {
        max-width: 250px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo Header - Ersetze "logo.png" mit deinem Bildpfad -->
    <div class="logo-header">
      <img src="cgnew.png" alt="CG Adventskalender" onerror="this.style.display='none'; document.getElementById('fallback-title').style.display='block';">
    </div>
    <h1 id="fallback-title" style="display: none;">üéÑ CG Adventskalender üéÑ</h1>
    
    <div id="login">
      <h2>Login</h2>
      <input id="username" placeholder="Benutzername">
      <input id="password" placeholder="Passwort" type="password">
      <button onclick="login()">Einloggen</button>
      <div id="login-msg"></div>
    </div>

    <div id="calendar" class="hidden">
      <div class="welcome-section">
        <h2>Willkommen, <span id="userLabel"></span>!</h2>
        <p id="progress"></p>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
      <div id="doors"></div>
    </div>
  </div>

  <!-- Story Modal -->
  <div class="modal-overlay" id="storyModal">
    <div class="modal-content">
      <h2 id="modalTitle">T√ºrchen 1</h2>
      <div id="modalStory"></div>
      <button class="modal-close-btn" onclick="closeStoryModal()">Schlie√üen</button>
    </div>
  </div>

  <script>
    // Create snowflakes
    function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');
      snowflake.innerHTML = '‚ùÑ';
      snowflake.style.left = Math.random() * 100 + '%';
      snowflake.style.animationDuration = Math.random() * 3 + 5 + 's';
      snowflake.style.opacity = Math.random();
      snowflake.style.fontSize = Math.random() * 10 + 10 + 'px';
      
      document.body.appendChild(snowflake);
      
      setTimeout(() => {
        snowflake.remove();
      }, 8000);
    }
    
    // Create snowflakes periodically
    setInterval(createSnowflake, 200);
    
    // Initial snowflakes
    for (let i = 0; i < 50; i++) {
      setTimeout(createSnowflake, i * 100);
    }

    const firebaseConfig = {
      apiKey: "AIzaSyC1QIEr0IjLVQx-WlYYG1iRo08LmyuqWXY",
      authDomain: "cg-adventskalender.firebaseapp.com",
      projectId: "cg-adventskalender",
      storageBucket: "cg-adventskalender.firebasestorage.app",
      messagingSenderId: "823914577697",
      appId: "1:823914577697:web:5885b5e51513a21bd80860"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentUser = null;

    // Story-Texte f√ºr jedes T√ºrchen - HIER DEINE GESCHICHTEN EINF√úGEN!
    const storyTexts = {
      1: `<p>Es war einmal in einem verschneiten Winterdorf... Die Crystal Guards wurden gerufen, um ein gro√ües Geheimnis zu l√ºften.</p><p><strong>Deine Aufgabe:</strong> Wie hei√üt der Hauptcharakter unserer Geschichte?</p>`,
      2: `<p>Der Hauptcharakter machte sich auf den Weg durch den tiefen Schnee. Pl√∂tzlich tauchte ein mysteri√∂ser Fremder auf...</p><p><strong>Deine Aufgabe:</strong> Was sagte der Fremde?</p>`,
      3: `<p>Die Reise f√ºhrt weiter in den magischen Wald. Zwischen den B√§umen glitzert etwas...</p><p><strong>Deine Aufgabe:</strong> Was haben die Crystal Guards gefunden?</p>`,
      4: `<p>Ein neues Abenteuer beginnt! Die Guards entdecken eine alte Karte...</p><p><strong>Deine Aufgabe:</strong> Wohin f√ºhrt die Karte?</p>`,
      5: `<p>Die Spannung steigt... Ein R√§tsel muss gel√∂st werden!</p><p><strong>Deine Aufgabe:</strong> L√∂se das R√§tsel!</p>`,
      6: `<p>Fortsetzung folgt... Die Guards treffen auf einen alten Weisen.</p><p><strong>Deine Aufgabe:</strong> Was ist die Weisheit des Tages?</p>`,
      7: `<p>Eine Woche ist vergangen... Die Crystal Guards finden einen geheimen Pfad.</p><p><strong>Deine Aufgabe:</strong> Beschreibe den Pfad!</p>`,
      8: `<p>Die zweite Woche beginnt mit einer √úberraschung!</p><p><strong>Deine Aufgabe:</strong> Was ist passiert?</p>`,
      9: `<p>Ein mysteri√∂ser Nebel zieht auf...</p><p><strong>Deine Aufgabe:</strong> Was verbirgt sich im Nebel?</p>`,
      10: `<p>Die Guards finden einen alten Tempel...</p><p><strong>Deine Aufgabe:</strong> Was steht auf der Inschrift?</p>`,
      11: `<p>Ein magisches Artefakt wird entdeckt!</p><p><strong>Deine Aufgabe:</strong> Welche Kraft hat es?</p>`,
      12: `<p>Die H√§lfte des Abenteuers ist geschafft! Ein gro√ües Fest wird gefeiert.</p><p><strong>Deine Aufgabe:</strong> Was gibt es zu essen?</p>`,
      13: `<p>Die Geschichte nimmt eine unerwartete Wendung...</p><p><strong>Deine Aufgabe:</strong> Was passiert als n√§chstes?</p>`,
      14: `<p>Ein Schneesturm zieht auf! Die Guards m√ºssen Schutz suchen.</p><p><strong>Deine Aufgabe:</strong> Wo finden sie Unterschlupf?</p>`,
      15: `<p>Die dritte Woche beginnt... Ein neuer Verb√ºndeter erscheint!</p><p><strong>Deine Aufgabe:</strong> Wer ist es?</p>`,
      16: `<p>Die Guards entdecken eine geheime Botschaft...</p><p><strong>Deine Aufgabe:</strong> Was steht in der Botschaft?</p>`,
      17: `<p>Ein gef√§hrlicher Gegner taucht auf!</p><p><strong>Deine Aufgabe:</strong> Wie sieht er aus?</p>`,
      18: `<p>Die Guards m√ºssen eine wichtige Entscheidung treffen...</p><p><strong>Deine Aufgabe:</strong> Welche?</p>`,
      19: `<p>Ein magischer Kristall wird gefunden!</p><p><strong>Deine Aufgabe:</strong> Welche Farbe hat er?</p>`,
      20: `<p>Die letzte Woche bricht an... Das Finale naht!</p><p><strong>Deine Aufgabe:</strong> Was ist das gro√üe Ziel?</p>`,
      21: `<p>Die Spannung steigt... Noch 3 Tage bis zum gro√üen Finale!</p><p><strong>Deine Aufgabe:</strong> Was muss noch vorbereitet werden?</p>`,
      22: `<p>Fast geschafft! Die Guards bereiten sich auf die letzte Schlacht vor.</p><p><strong>Deine Aufgabe:</strong> Welche Waffe w√§hlst du?</p>`,
      23: `<p>Der vorletzte Tag... Die Ruhe vor dem Sturm.</p><p><strong>Deine Aufgabe:</strong> Was geht dir durch den Kopf?</p>`,
      24: `<p>üéÑ DAS GROSSE FINALE! üéÑ</p><p>Die Crystal Guards haben es geschafft! Die Geschichte endet mit...</p><p><strong>Deine Aufgabe:</strong> Wie endet die Geschichte?</p>`
    };

    function openStoryModal(doorNumber) {
      document.getElementById('modalTitle').innerText = 'T√ºrchen ' + doorNumber;
      document.getElementById('modalStory').innerHTML = storyTexts[doorNumber] || '<p>Hier k√∂nnte deine Geschichte stehen...</p>';
      document.getElementById('storyModal').classList.add('active');
    }

    function closeStoryModal() {
      document.getElementById('storyModal').classList.remove('active');
    }

    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('storyModal');
      if (event.target === modal) {
        closeStoryModal();
      }
    });

    // Check if door should be unlocked based on current date
    function isDoorUnlocked(doorNumber) {
      const now = new Date();
      const currentDay = now.getDate();
      const currentMonth = now.getMonth() + 1; // 0-indexed
      
      // Only unlock in December and only up to current day
      if (currentMonth === 11 && doorNumber <= currentDay) {
        return true;
      }
      
      // For testing: unlock all doors in other months
      if (currentMonth !== 11) {
        return true;
      }
      
      return false;
    }

    function login() {
      const name = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      
      if (!name || !pass) {
        document.getElementById("login-msg").innerText = "Bitte beide Felder ausf√ºllen.";
        return;
      }

      db.collection("users").doc(name).get()
        .then(doc => {
          if (!doc.exists) {
            document.getElementById("login-msg").innerText = "Benutzer nicht gefunden.";
            return;
          }
          if (doc.data().password !== pass) {
            document.getElementById("login-msg").innerText = "Falsches Passwort.";
            return;
          }
          
          currentUser = name;
          document.getElementById("userLabel").innerText = name;
          document.getElementById("login").classList.add("hidden");
          document.getElementById("calendar").classList.remove("hidden");
          document.getElementById("login-msg").innerText = "";
          loadAnswers();
        })
        .catch(error => {
          console.error("Fehler beim Login:", error);
          document.getElementById("login-msg").innerText = "Verbindungsfehler. Bitte erneut versuchen.";
        });
    }

    function logout() {
      currentUser = null;
      document.getElementById("calendar").classList.add("hidden");
      document.getElementById("login").classList.remove("hidden");
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
    }

    function toggleDoor(i) {
      const container = document.getElementById("door-container-" + i);
      
      // Check if door is locked
      if (container.classList.contains("locked")) {
        // Show message that door is still locked
        alert("Dieses T√ºrchen kann erst am " + i + ". Dezember ge√∂ffnet werden! üéÑ");
        return;
      }
      
      if (container.classList.contains("open")) {
        // Close door
        container.classList.remove("open");
      } else {
        // Open door
        container.classList.add("open");
      }
    }

    function loadAnswers() {
      const container = document.getElementById("doors");
      container.innerHTML = "";
      
      db.collection("answers").doc(currentUser).get()
        .then(doc => {
          const data = doc.exists ? doc.data() : {};
          let answered = 0;
          
          for (let i = 1; i <= 24; i++) {
            const key = "tag" + i;
            const val = data[key] || "";
            if (val) answered++;
            
            const doorContainer = document.createElement("div");
            doorContainer.className = "door-container";
            doorContainer.id = "door-container-" + i;
            
            const isUnlocked = isDoorUnlocked(i);
            if (!isUnlocked) {
              doorContainer.classList.add("locked");
            }
            
            const lockHTML = !isUnlocked ? `
              <div class="lock-container">
                <div class="lock-icon">
                  <div class="lock-shackle"></div>
                  <div class="lock-body">
                    <div class="lock-keyhole"></div>
                  </div>
                </div>
              </div>
            ` : '';
            
            doorContainer.innerHTML = `
              <div class="door-content">
                <h3>T√ºrchen ${i}</h3>
                <button class="story-btn" onclick="openStoryModal(${i})">üìñ Story lesen</button>
                <input id="input${i}" value="${val}" placeholder="Deine Antwort">
                <button onclick="saveAnswer(${i})">Speichern</button>
                <button class="close-btn" onclick="toggleDoor(${i})">Schlie√üen</button>
                <div class="status" id="status${i}"></div>
              </div>
              ${lockHTML}
              <div class="door-left" onclick="toggleDoor(${i})">
                <div class="door-number">${i}</div>
              </div>
              <div class="door-right" onclick="toggleDoor(${i})">
                <img src="crystal.png" class="crystal-icon" alt="Crystal" onerror="this.style.display='none'; this.parentElement.innerHTML += '<div class=\\'door-number\\'>üéÅ</div>';">
              </div>
            `;
            
            container.appendChild(doorContainer);
          }
          
          document.getElementById("progress").innerText = `abgeschlossen: ${answered}/24 üéÅ`;
        })
        .catch(error => {
          console.error("Fehler beim Laden:", error);
        });
    }

    function saveAnswer(i) {
      const val = document.getElementById("input" + i).value.trim();
      if (!val) return;
      
      const key = "tag" + i;
      db.collection("answers").doc(currentUser).set({ [key]: val }, { merge: true })
        .then(() => {
          document.getElementById("status" + i).innerText = "‚úÖ Gespeichert!";
          setTimeout(() => {
            toggleDoor(i);
            setTimeout(() => loadAnswers(), 600);
          }, 1000);
        })
        .catch(error => {
          console.error("Fehler beim Speichern:", error);
          alert("Fehler beim Speichern. Bitte erneut versuchen.");
        });
    }
  </script>
</body>
</html>
